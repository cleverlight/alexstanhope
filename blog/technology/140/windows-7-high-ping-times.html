<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Windows 7 high ping times | Alex Stanhope</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="http://themes/lightenna/lightenna.ico" type="image/x-icon" />
    <link type="text/css" rel="stylesheet" media="all" href="/legacy/modules/aggregator/aggregator.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/modules/node/node.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/modules/system/defaults.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/modules/system/system.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/modules/system/system-menus.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/modules/user/user.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/sites/all/modules/contrib/lightbox2/css/lightbox.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/sites/all/modules/contrib/video_filter/video_filter.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/sites/all/themes/contrib/glossyblue/style.css" />
<link type="text/css" rel="stylesheet" media="all" href="/legacy/sites/all/themes/glossyblue_alex/style_alex.css" />
    <script type="text/javascript" src="/legacy/misc/jquery.js"></script>
<script type="text/javascript" src="/legacy/misc/drupal.js"></script>
<script type="text/javascript" src="/legacy/sites/all/modules/contrib/lightbox2/js/auto_image_handling.js"></script>
<script type="text/javascript" src="/legacy/sites/all/modules/contrib/lightbox2/js/lightbox.js"></script>
<script type="text/javascript" src="/legacy/misc/tableheader.js"></script>
<script type="text/javascript" src="/legacy/sites/all/modules/contrib/google_analytics/googleanalytics.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "lightbox2": { "rtl": 0, "file_path": "/(\\w\\w/)system/files", "default_image": "/legacy/sites/all/modules/contrib/lightbox2/images/brokenimage.jpg", "border_size": 10, "font_color": "000", "box_color": "fff", "top_position": "", "overlay_opacity": "0.8", "overlay_color": "000", "disable_close_click": 1, "resize_sequence": 0, "resize_speed": 400, "fade_in_speed": 400, "slide_down_speed": 600, "use_alt_layout": 0, "disable_resize": 0, "disable_zoom": 0, "force_show_nav": 0, "show_caption": true, "loop_items": 0, "node_link_text": "View Image Details", "node_link_target": 0, "image_count": "Image !current of !total", "video_count": "Video !current of !total", "page_count": "Page !current of !total", "lite_press_x_close": "press \x3ca href=\"#\" onclick=\"hideLightbox(); return FALSE;\"\x3e\x3ckbd\x3ex\x3c/kbd\x3e\x3c/a\x3e to close", "download_link_text": "", "enable_login": false, "enable_contact": false, "keys_close": "c x 27", "keys_previous": "p 37", "keys_next": "n 39", "keys_zoom": "z", "keys_play_pause": "32", "display_image_size": "original", "image_node_sizes": "(\\.thumbnail|\\.preview)", "trigger_lightbox_classes": "img.thumbnail, img.image-thumbnail,img.preview, img.image-preview,img., img.image-", "trigger_lightbox_group_classes": "", "trigger_slideshow_classes": "", "trigger_lightframe_classes": "", "trigger_lightframe_group_classes": "", "custom_class_handler": 0, "custom_trigger_classes": "", "disable_for_gallery_lists": 1, "disable_for_acidfree_gallery_lists": true, "enable_acidfree_videos": true, "slideshow_interval": 5000, "slideshow_automatic_start": true, "slideshow_automatic_exit": true, "show_play_pause": true, "pause_on_next_click": false, "pause_on_previous_click": true, "loop_slides": false, "iframe_width": 600, "iframe_height": 400, "iframe_border": 1, "enable_video": 0 }, "googleanalytics": { "trackOutbound": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip" } });
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create", "UA-25142278-3", { "cookieDomain": "auto" });ga("send", "pageview");
//--><!]]>
</script>
    <script src="/legacy/sites/all/themes/glossyblue_alex/js/swfobject.js" language="javascript"></script>
    <style type="text/css" media="print">@import "/legacy/sites/all/themes/glossyblue_alex/print.css";</style>
  </head>
  <body>
<div id="page">
  <div id="header">
    <div id="headerimg">
	  <h1><a href="/">Alex Stanhope</a></h1>
	  <div class="description"></div>
	</div>
	
	      <ul class="nav"><li class="menu-99 first last"><a href="/">Blog</a></li>
</ul>      </div>
  <div id="content">
    <div class="breadcrumb"><a href="/">Home</a></div>                        <h2>Windows 7 high ping times</h2>    
  
  <div style="margin-top: -10px" id="node-140" class="post node">
    <span class="post-cat"><ul class="links inline"><li class="taxonomy_term_1 first last"><a href="../../technology.1.html" rel="tag" title="">technology</a></li>
</ul></span><span class="post-calendar">Mon, 2009-11-09 10:44</span>
    <div class="post-content">
      <p><strong>Update 21/12/09: This is now sorted.  See below for solution.</strong></p>
<p>Ah, the agony of invisible Operating System behaviours!  I noticed my browser experience slowing down.  After running a gamut of tests, the cause seemed to be a slow ping time, but it didn't seem to affect all my computers.  Ping times seemed fine until I ran Dropbox (v0.6.557) on Windows 7 (build 7600).</p>
<p>Ping to google.com<br />
Reply from 66.102.9.105: bytes=32 time=18ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=25ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=20ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=20ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=17ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=19ms TTL=54<br />
>> DropBox status 'Initialising'<br />
Reply from 66.102.9.105: bytes=32 time=18ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=20ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=18ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=21ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=22ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=20ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=29ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=31ms TTL=54<br />
>> Dropbox status 'Uploading 3 files'<br />
Reply from 66.102.9.105: bytes=32 time=644ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=996ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=1620ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=2047ms TTL=54<br />
Reply from 66.102.9.105: bytes=32 time=3375ms TTL=54<br />
Request timed out.<br />
Request timed out.</p>
<p>The problem seems to be related to upload activity.  When one of my applications (such as Dropbox) is uploading, my ping times explode.  Further testing indicates that this may be peculiar to Dropbox/HTTP, as WinSCP can upload over SSH without replicating the problem.</p>
<p>The behaviour is consistent across different adaptors (Dell D620, Broadcom NetXtreme 57xx Gigabit Ethernet, Intel PRO Wireless 3945ABG) connections (Zen home broadband, external WiFi), operating system versions (Windows 7 Business 32 bit and 64 bit) and machines (Quad-core 6600, Gigabyte P35C-DS3R, Corsair 2GB 1066Mhz DDR, WD Raptor 150GB and Dell Latitude D620<br />
).</p>
<p>Dropbox also shows a meaningless progress report, but I think that's unrelated:</p>
<p><img src="/legacy/system/files/dropbox_zero_status.gif" alt="dropbox status" /></p>
<p>Have found some recommendations at <a href="http://www.sevenforums.com/gaming/11064-windows-7-high-ping-fix-2.html">Windows Seven Forums</a> and <a href="http://www.computing.net/answers/networking/ping-general-failure-and-high-ping-times/38463.html<br />
">Computing Forums</a> but nothing to restore balance to my network connections.  I tried:</p>
<p>netsh interface tcp set global autotuning=disabled<br />
netsh interface tcp set global autotuninglevel=disabled</p>
<p>but ping times were unaffected.  I then restored those settings to their default with:</p>
<p>netsh interface tcp set global autotuning=normal<br />
netsh interface tcp set global autotuninglevel=normal</p>
<p>Other posts<br />
I've posted this problem up on a few fora.  I'll advise on how I get on:</p>
<ul>
<li>
<a href="http://connect.microsoft.com/LiveMesh/feedback/ViewFeedback.aspx?FeedbackID=469757">Microsoft Connect, LiveMesh</a>
</li>
<li>
<a href="http://www.sevenforums.com/gaming/11064-windows-7-high-ping-fix-4.html#post395198">Windows Seven Forum</a>
</li>
<li>
<a href="http://forums.dropbox.com/topic.php?id=15223">Dropbox Bugs and Troubleshooting Forum</a>
</li>
</ul>
<p>Update: this problem is worsening.  Not only do ping times increase drastically, but upload efficiency drops off a cliff.  Dropbox has been trying to upload a 12MB file for several hours and it's consumed over 400MB of upload bandwidth (according to Windows' Local Area Connection status).  I have a capped Broadband connection and this kind of waste is expensive!</p>
<p>C:\Users\alex>netstat -o</p>
<p>Active Connections</p>
<p>  Proto  Local Address          Foreign Address        State           PID<br />
  TCP    10.12.1.120:49808      a92-122-208-201:http   TIME_WAIT       0<br />
  TCP    10.12.1.120:49811      a92-122-208-248:http   TIME_WAIT       0<br />
  TCP    10.12.1.120:49852      174:https              CLOSE_WAIT      5876<br />
  TCP    10.12.1.120:49853      174:https              CLOSE_WAIT      5876<br />
  TCP    10.12.1.120:49854      208:http               ESTABLISHED     5876<br />
  TCP    10.12.1.120:49855      174:https              CLOSE_WAIT      5876<br />
  TCP    10.12.1.120:49856      ec2-75-101-145-128:https  ESTABLISHED     5876<br />
  TCP    10.12.1.120:49857      ec2-75-101-145-128:https  ESTABLISHED     5876<br />
  TCP    127.0.0.1:49750        leo:49751              ESTABLISHED     5832<br />
  TCP    127.0.0.1:49751        leo:49750              ESTABLISHED     5832<br />
  TCP    127.0.0.1:49752        leo:49753              ESTABLISHED     5832<br />
  TCP    127.0.0.1:49753        leo:49752              ESTABLISHED     5832</p>
<p>The problem seems to be related to the HTTPS upload threads.  Dropbox [PID 5876] uses Amazon's ec2, hence ec2-75-101-145-180.</p>
<p>The problem appears to be unaffected by upgrading to the latest current version of Dropbox (v0.6.570).  Ping times still rocket (500-2000ms).  I have tested on a 1MB upload normal service was restored quite quickly (about 15 to 20s).  Unfortunately this isn't true once the connection beds in: a 13MB file still presents with high ping times when uploading and consumes >90MB upload data.</p>
<p>I'm not certain this is a Dropbox problem.  I get the same symptoms when uploading video to YouTube.  I suspect it's a Windows 7 HTTP/HTTPS upload problem, as WinSCP was unaffected (SSH).</p>
<p>Update 19/12/09<br />
I had a reply from Dropbox suggesting it might be a conflict with my antivirus software (NOD32).  I found this reference:</p>
<p><a href="http://www.wilderssecurity.com/showthread.php?t=247163">http://www.wilderssecurity.com/showthread.php?t=247163</a></p>
<p>I've disabled HTTP checking as described and so far things seem better.  I need to do some more robust tests.</p>
<p>Update 21/12/09<br />
This is sorted.  I've just uploaded a 14MB file to Dropbox within efficiency bounds.  Ping times fluctuated (two example periods below):</p>
<p>(lower)<br />
Reply from 216.239.59.103: bytes=32 time=89ms TTL=52<br />
Reply from 216.239.59.103: bytes=32 time=77ms TTL=52<br />
Reply from 216.239.59.103: bytes=32 time=66ms TTL=52<br />
Reply from 216.239.59.103: bytes=32 time=66ms TTL=52<br />
(higher)<br />
Reply from 216.239.59.103: bytes=32 time=517ms TTL=52<br />
Reply from 216.239.59.103: bytes=32 time=549ms TTL=52<br />
Reply from 216.239.59.103: bytes=32 time=329ms TTL=52<br />
Reply from 216.239.59.103: bytes=32 time=310ms TTL=52</p>
<p>Similarly it took roughly 18Mb of net traffic to upload the 14.5MB (15.8Mb) file, which is ok.</p>
<p>Problem: bug in ESET NOD32 Antivirus version 4.0.467.0<br />
Build versions:<br />
Virus signature database: 4706 (20091221)<br />
Update module: 1031 (20091029)<br />
Antivirus and antispyware scanner module: 1253 (20091214)<br />
Advanced heuristics module: 1099 (20091030)<br />
Archive support module: 1105 (20091029)<br />
Cleaner module: 1048 (20091123)<br />
Anti-Stealth support module: 1012 (20090526)<br />
SysInspector module: 1213 (20090902)<br />
Self-defense support module : 1009 (20090917)</p>
<p>Solution: Open NOD32 "Advanced setup" from the quicktray menu.  Uncheck "Enable HTTP checking" in "Web access protection -> HTTP, HTTPS".</p>
<p>In summary this was a horrible problem and it took many hours to resolve.  It all comes down to the integration between software components.  A feature in ESET's NOD32, which was designed to protect me from viri ended up behaving like a virus and wasting GB of net traffic, conflicted with Windows 7 and was triggered by legitimate behaviour in Dropbox.  No one party will take responsibility, though I wish ESET would.</p>
<table id="attachments" class="sticky-enabled">
 <thead><tr><th>Attachment</th><th>Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td><a href="/legacy/system/files/dropbox_zero_status.gif">dropbox_zero_status.gif</a></td><td>11.45 KB</td> </tr>
</tbody>
</table>
          </div>    
</div>
<div class="clear"></div>    
	<div class="navigation">
	  <span class="previous-entries"></span> <span class="next-entries"></span>
	</div>	
		
	  </div><!--/content -->
  
<div id="sidebar-right">
<ul>
  <li>
      </li>
          <div id="block-block-6" class="clear-block block block-block">


  <div class="content"><p style="margin-top:5px;">
<script type="text/javascript" src="http://www.freerangefeedback.com/wito_rcv/js/wito_embed.js"></script><script type="text/javascript">
var wito_domainID = 52;
</script></p><p><a href="http://www.freerangefeedback.com" class="wito_embed_link wito_link_look" style="visibility: hidden">Feedback</a></p>
</div>
</div>
<div id="block-block-9" class="clear-block block block-block">


  <div class="content"><a href="http://twitter.com/alex_stanhope"><img src="/legacy/sites/all/themes/glossyblue_alex/images/twitter3gif.gif" alt="Follow Alex Stanhope on twitter" /></a></div>
</div>
<div id="block-block-10" class="clear-block block block-block">


  <div class="content"><h2>Online profiles</h2>

<p><a href="http://uk.linkedin.com/in/alexstanhope"><img src="/legacy/sites/all/themes/glossyblue_alex/icons/linkedin_32.png" alt="LinkedIn" /></a>

<a href="http://twitter.com/alex_stanhope"><img src="/legacy/sites/all/themes/glossyblue_alex/icons/twitter_32.png" alt="Twitter" /></a>

<a href="http://www.facebook.com/alexstanhopecom"><img src="/legacy/sites/all/themes/glossyblue_alex/icons/facebook_32.png" alt="Facebook" /></a>

<a href="http://www.flickr.com/photos/alex_stanhope/"><img src="/legacy/sites/all/themes/glossyblue_alex/icons/flickr_32.png" alt="Flickr" /></a>

<a href="http://www.google.com/profiles/alex.stanhope"><img src="/legacy/sites/all/themes/glossyblue_alex/icons/google_32.png" alt="Google" /></a>

<a href="http://www.youtube.com/user/alexstanhopecom"><img src="/legacy/sites/all/themes/glossyblue_alex/icons/youtube_32.png" alt="YouTube" /></a>

</p></div>
</div>
    
</ul>

</div><!--/sidebar -->

  <hr class="clear" />
  <!--/header -->
</div>
<div id="credits">
<div class="alignleft"><a href="/">Alex Stanhope</a> is a Technology consultant to the UK Creative Industries and Venture Catalyst.  This is my personal website.<br />
<a href="http://maps.google.co.uk/?ie=UTF8&amp;ll=51.45497,-2.604103&amp;spn=0.036262,0.066605&amp;z=14">Bristol</a> | <a href="http://www.lightenna.com">Lightenna</a> | <a href="http://www.mkp.org.uk">ManKind Project</a> | <a href="http://www.goodk.co.uk">goodkarma</a><br />

All material copyright (c) 2006-2010 | <a href="http://www.lightenna.com">Website by Lightenna</a>, featuring <a href="http://www.ndesign-studio.com/">N.Design</a>'s GlossyBlue theme.</div> 
<div class="alignright"></div>

</div>

    </body>
</html>
